<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CV Generator</title>
    <!-- Using CDN links for jsPDF and html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        :root {
            --primary-color: #3f51b5;
            --secondary-color: #f5f5f5;
            --accent-color: #ff4081;
            --text-color: #333;
            --light-text: #777;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f0f2f5;
            color: var(--text-color);
            line-height: 1.6;
        }

        header {
            background-color: var(--primary-color);
            color: white;
            text-align: center;
            padding: 2rem 0;
            margin-bottom: 2rem;
            box-shadow: var(--box-shadow);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .tabs {
            display: flex;
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--primary-color);
            overflow-x: auto;
        }

        .tab {
            padding: 1rem 1.5rem;
            cursor: pointer;
            background-color: var(--secondary-color);
            border-top-left-radius: var(--border-radius);
            border-top-right-radius: var(--border-radius);
            margin-right: 0.5rem;
            transition: all 0.3s ease;
        }

        .tab.active {
            background-color: var(--primary-color);
            color: white;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .form-group {
            margin-bottom: 1.5rem;
            background-color: white;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        input, textarea, select {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #303f9f;
        }

        .btn-accent {
            background-color: var(--accent-color);
        }

        .btn-accent:hover {
            background-color: #d81b60;
        }

        .btn-container {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
        }

        .dynamic-fields {
            margin-top: 1rem;
        }

        .field-group {
            background-color: var(--secondary-color);
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            position: relative;
        }

        .remove-field {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background-color: var(--accent-color);
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .preview-container {
            background-color: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 2rem;
        }

        /* Styles for CV preview. Adapted for PDF. */
        #cv-preview {
            font-family: Arial, sans-serif;
            font-size: 12pt;
            line-height: 1.4;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            border: 1px solid #ccc;
        }

        .cv-header { display: flex; align-items: flex-start; margin-bottom: 20px; }
        .profile-img-container { width: 120px; height: 120px; border-radius: 50%; overflow: hidden; margin-right: 20px; border: 3px solid var(--primary-color);}
        .profile-img { width: 100%; height: 100%; object-fit: cover; }
        .cv-name { font-size: 24pt; font-weight: bold; color: var(--primary-color); margin-bottom: 5px; }
        .cv-title { font-size: 14pt; color: var(--light-text); margin-bottom: 10px;}
        .contact-info { display: flex; flex-wrap: wrap; gap: 10px; }
        .contact-item { font-size: 10pt; }
        .contact-icon { margin-right: 5px; color: var(--primary-color); }

        .cv-section { margin-bottom: 20px; }
        .cv-section-title { font-size: 16pt; font-weight: bold; color: var(--primary-color); border-bottom: 1px solid var(--primary-color); padding-bottom: 5px; margin-bottom: 10px; }
        .cv-section-content { padding-left: 10px; }

        .education-item, .experience-item, .certification-item { margin-bottom: 15px; }
        .item-header { display: flex; justify-content: space-between; margin-bottom: 3px; }
        .item-title { font-size: 12pt; font-weight: bold; }
        .item-date { font-size: 10pt; color: var(--light-text); }
        .item-subtitle { font-size: 10pt; color: var(--light-text); margin-bottom: 5px; }

        .skills-container { display: flex; flex-wrap: wrap; gap: 5px; }
        .skill-tag { background-color: var(--primary-color); color: white; padding: 3px 8px; border-radius: 12px; font-size: 10pt; }

        .theme-selector {
            margin-bottom: 1.5rem;
            background-color: white;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        .color-options {
            display: flex;
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.2s;
            border: 2px solid transparent;
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.active {
            border: 2px solid #333;
        }

        .photo-upload {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .photo-preview {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            overflow: hidden;
            margin: 1rem 0;
            border: 4px solid var(--primary-color);
        }

        .photo-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        #photo-upload-btn {
            margin-bottom: 1rem;
        }

        .progress-bar {
            width: 100%;
            background-color: var(--secondary-color);
            border-radius: 10px;
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .progress {
            height: 10px;
            background-color: var(--primary-color);
            width: 0;
            transition: width 0.5s ease;
        }

        @media (max-width: 768px) {
            .cv-header {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }

            .profile-img-container {
                margin-right: 0;
                margin-bottom: 1rem;
            }

            .tab {
                padding: 0.8rem 1rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Professional CV Generator</h1>
            <p>Create a stunning, personalized CV in minutes</p>
        </div>
    </header>

    <div class="container">
        <div class="progress-bar">
            <div class="progress" id="progress-bar"></div>
        </div>

        <div class="tabs">
            <div class="tab active" data-tab="personal">Personal Info</div>
            <div class="tab" data-tab="photo">Photo</div>
            <div class="tab" data-tab="education">Education</div>
            <div class="tab" data-tab="experience">Experience</div>
            <div class="tab" data-tab="skills">Skills</div>
            <div class="tab" data-tab="certifications">Certifications</div>
            <div class="tab" data-tab="design">Design</div>
            <div class="tab" data-tab="preview">Preview</div>
        </div>

        <!-- Personal Information -->
        <div class="tab-content active" id="personal">
            <div class="form-group">
                <h2>Personal Information</h2>
                <div class="row">
                    <div>
                        <label for="name">Full Name</label>
                        <input type="text" id="name" placeholder="e.g., John Doe">
                    </div>
                    <div>
                        <label for="title">Professional Title</label>
                        <input type="text" id="title" placeholder="e.g., Senior Software Engineer">
                    </div>
                </div>
                <div class="row">
                    <div>
                        <label for="email">Email</label>
                        <input type="email" id="email" placeholder="e.g., john.doe@example.com">
                    </div>
                    <div>
                        <label for="phone">Phone</label>
                        <input type="tel" id="phone" placeholder="e.g., +1 (123) 456-7890">
                    </div>
                </div>
                <div>
                    <label for="address">Address (Optional)</label>
                    <input type="text" id="address" placeholder="e.g., New York, NY">
                </div>
                <div>
                    <label for="linkedin">LinkedIn (Optional)</label>
                    <input type="text" id="linkedin" placeholder="e.g., linkedin.com/in/johndoe">
                </div>
                <div>
                    <label for="website">Website/Portfolio (Optional)</label>
                    <input type="text" id="website" placeholder="e.g., johndoe.com">
                </div>
                <div>
                    <label for="summary">Professional Summary</label>
                    <textarea id="summary" rows="4" placeholder="Brief overview of your professional background and key strengths..."></textarea>
                </div>
            </div>
            <div class="btn-container">
                <div></div> <!-- Empty div for flex spacing -->
                <button class="next-tab">Next: Photo</button>
            </div>
        </div>

        <!-- Photo Upload -->
        <div class="tab-content" id="photo">
            <div class="form-group">
                <h2>Profile Photo</h2>
                <div class="photo-upload">
                    <p>Upload a professional photo for your CV (recommended size: square, at least 300x300px)</p>
                    <input type="file" id="photo-upload" accept="image/*" style="display: none;">
                    <button id="photo-upload-btn">Choose Photo</button>
                    <div class="photo-preview">
                        <img id="photo-preview-img" src="/api/placeholder/300/300" alt="Profile Photo">
                    </div>
                </div>
            </div>
            <div class="btn-container">
                <button class="prev-tab">Previous: Personal Info</button>
                <button class="next-tab">Next: Education</button>
            </div>
        </div>

        <!-- Education Section -->
        <div class="tab-content" id="education">
            <div class="form-group">
                <h2>Education</h2>
                <p>Add your educational background, starting with the most recent.</p>
                <div id="education-fields" class="dynamic-fields"></div>
                <button id="add-education" class="btn-accent">+ Add Education</button>
            </div>
            <div class="btn-container">
                <button class="prev-tab">Previous: Photo</button>
                <button class="next-tab">Next: Experience</button>
            </div>
        </div>

        <!-- Experience Section -->
        <div class="tab-content" id="experience">
            <div class="form-group">
                <h2>Work Experience</h2>
                <p>Add your work experience, starting with the most recent.</p>
                <div id="experience-fields" class="dynamic-fields"></div>
                <button id="add-experience" class="btn-accent">+ Add Experience</button>
            </div>
            <div class="btn-container">
                <button class="prev-tab">Previous: Education</button>
                <button class="next-tab">Next: Skills</button>
            </div>
        </div>

        <!-- Skills Section -->
        <div class="tab-content" id="skills">
            <div class="form-group">
                <h2>Skills</h2>
                <p>Add your key skills (separate with commas)</p>
                <textarea id="skills-input" rows="4" placeholder="e.g., JavaScript, React, Project Management, Team Leadership, UI/UX Design"></textarea>
            </div>
            <div class="btn-container">
                <button class="prev-tab">Previous: Experience</button>
                <button class="next-tab">Next: Certifications</button>
            </div>
        </div>

        <!-- Certifications Section -->
        <div class="tab-content" id="certifications">
            <div class="form-group">
                <h2>Certifications</h2>
                <p>Add relevant certifications or professional qualifications.</p>
                <div id="certification-fields" class="dynamic-fields"></div>
                <button id="add-certification" class="btn-accent">+ Add Certification</button>
            </div>
            <div class="btn-container">
                <button class="prev-tab">Previous: Skills</button>
                <button class="next-tab">Next: Design</button>
            </div>
        </div>

        <!-- Design Section -->
        <div class="tab-content" id="design">
            <div class="theme-selector">
                <h2>Choose a Color Theme</h2>
                <p>Select a primary color for your CV</p>
                <div class="color-options">
                    <div class="color-option active" style="background-color: #3f51b5;" data-color="#3f51b5"></div>
                    <div class="color-option" style="background-color: #2196F3;" data-color="#2196F3"></div>
                    <div class="color-option" style="background-color: #009688;" data-color="#009688"></div>
                    <div class="color-option" style="background-color: #4CAF50;" data-color="#4CAF50"></div>
                    <div class="color-option" style="background-color: #FF5722;" data-color="#FF5722"></div>
                    <div class="color-option" style="background-color: #795548;" data-color="#795548"></div>
                    <div class="color-option" style="background-color: #607D8B;" data-color="#607D8B"></div>
                    <div class="color-option" style="background-color: #9C27B0;" data-color="#9C27B0"></div>
                </div>
            </div>
            <div class="btn-container">
                <button class="prev-tab">Previous: Certifications</button>
                <button class="next-tab">Next: Preview</button>
            </div>
        </div>

        <!-- Preview Section -->
        <div class="tab-content" id="preview">
            <div class="preview-container">
                <div id="cv-preview">
                    <!-- CV content will be generated here -->
                </div>
            </div>
            <div class="form-group">
                <div class="btn-container">
                    <button id="download-pdf" class="btn-accent">Download as PDF</button>
                    <button class="prev-tab">Edit CV</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Ensure jsPDF is available
            const { jsPDF } = window.jspdf;
            
            // Tab navigation
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            const progressBar = document.getElementById('progress-bar');
            let currentTab = 0;

            function updateProgressBar() {
                const progress = ((currentTab + 1) / tabs.length) * 100;
                progressBar.style.width = `${progress}%`;
            }

            updateProgressBar();

            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');

                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));

                    this.classList.add('active');
                    document.getElementById(tabId).classList.add('active');

                    // Update current tab index
                    currentTab = Array.from(tabs).indexOf(this);
                    updateProgressBar();
                    
                    // Generate preview if needed
                    if (tabId === 'preview') {
                        generatePreview();
                    }
                });
            });

            // Next/Previous buttons
            document.querySelectorAll('.next-tab').forEach(button => {
                button.addEventListener('click', function() {
                    if (currentTab < tabs.length - 1) {
                        tabs[currentTab].classList.remove('active');
                        tabContents[currentTab].classList.remove('active');

                        currentTab++;

                        tabs[currentTab].classList.add('active');
                        tabContents[currentTab].classList.add('active');

                        updateProgressBar();

                        // If next tab is preview, generate the preview
                        if (tabs[currentTab].getAttribute('data-tab') === 'preview') {
                            generatePreview();
                        }
                    }
                });
            });

            document.querySelectorAll('.prev-tab').forEach(button => {
                button.addEventListener('click', function() {
                    if (currentTab > 0) {
                        tabs[currentTab].classList.remove('active');
                        tabContents[currentTab].classList.remove('active');

                        currentTab--;

                        tabs[currentTab].classList.add('active');
                        tabContents[currentTab].classList.add('active');

                        updateProgressBar();
                    }
                });
            });

            // Photo upload
            const photoInput = document.getElementById('photo-upload');
            const photoBtn = document.getElementById('photo-upload-btn');
            const photoPreview = document.getElementById('photo-preview-img');

            photoBtn.addEventListener('click', function() {
                photoInput.click();
            });

            photoInput.addEventListener('change', function(event) {
                if (event.target.files && event.target.files[0]) {
                    const reader = new FileReader();

                    reader.onload = function(e) {
                        photoPreview.src = e.target.result;
                    };

                    reader.readAsDataURL(event.target.files[0]);
                }
            });

            // Dynamic fields for Education
            const educationFields = document.getElementById('education-fields');
            const addEducationBtn = document.getElementById('add-education');

            addEducationBtn.addEventListener('click', function() {
                const fieldGroup = document.createElement('div');
                fieldGroup.className = 'field-group';

                fieldGroup.innerHTML = `
                    <button class="remove-field">×</button>
                    <div>
                        <label>Degree/Qualification</label>
                        <input type="text" class="education-degree" placeholder="e.g., Bachelor of Science in Computer Science">
                    </div>
                    <div>
                        <label>Institution</label>
                        <input type="text" class="education-institution" placeholder="e.g., University of Technology">
                    </div>
                    <div>
                        <label>Location (Optional)</label>
                        <input type="text" class="education-location" placeholder="e.g., New York, NY">
                    </div>
                    <div>
                        <label>Period</label>
                        <input type="text" class="education-period" placeholder="e.g., 2015 - 2019">
                    </div>
                    <div>
                        <label>Description (Optional)</label>
                        <textarea class="education-description" rows="3" placeholder="e.g., Relevant coursework, achievements, or projects..."></textarea>
                    </div>
                `;

                educationFields.appendChild(fieldGroup);

                // Add event listener to remove button
                fieldGroup.querySelector('.remove-field').addEventListener('click', function() {
                    educationFields.removeChild(fieldGroup);
                });
            });

            // Dynamic fields for Experience
            const experienceFields = document.getElementById('experience-fields');
            const addExperienceBtn = document.getElementById('add-experience');

            addExperienceBtn.addEventListener('click', function() {
                const fieldGroup = document.createElement('div');
                fieldGroup.className = 'field-group';

                fieldGroup.innerHTML = `
                    <button class="remove-field">×</button>
                    <div>
                        <label>Job Title</label>
                        <input type="text" class="experience-title" placeholder="e.g., Senior Software Engineer">
                    </div>
                    <div>
                        <label>Company/Organization</label>
                        <input type="text" class="experience-company" placeholder="e.g., Tech Solutions Inc.">
                    </div>
                    <div>
                        <label>Location (Optional)</label>
                        <input type="text" class="experience-location" placeholder="e.g., San Francisco, CA">
                    </div>
                    <div>
                        <label>Period</label>
                        <input type="text" class="experience-period" placeholder="e.g., Jan 2018 - Present">
                    </div>
                    <div>
                        <label>Description</label>
                        <textarea class="experience-description" rows="4" placeholder="Describe your responsibilities, achievements, and notable projects..."></textarea>
                    </div>
                `;

                experienceFields.appendChild(fieldGroup);

                // Add event listener to remove button
                fieldGroup.querySelector('.remove-field').addEventListener('click', function() {
                    experienceFields.removeChild(fieldGroup);
                });
            });

            // Dynamic fields for Certifications
            const certificationFields = document.getElementById('certification-fields');
            const addCertificationBtn = document.getElementById('add-certification');

            addCertificationBtn.addEventListener('click', function() {
                const fieldGroup = document.createElement('div');
                fieldGroup.className = 'field-group';

                fieldGroup.innerHTML = `
                    <button class="remove-field">×</button>
                    <div>
                        <label>Certification Name</label>
                        <input type="text" class="certification-name" placeholder="e.g., AWS Certified Solutions Architect">
                    </div>
                    <div>
                        <label>Issuing Organization</label>
                        <input type="text" class="certification-org" placeholder="e.g., Amazon Web Services">
                    </div>
                    <div>
                        <label>Date (Optional)</label>
                        <input type="text" class="certification-date" placeholder="e.g., May 2020">
                    </div>
                    <div>
                        <label>Description (Optional)</label>
                        <textarea class="certification-description" rows="2" placeholder="Brief description or credential ID..."></textarea>
                    </div>
                `;

                certificationFields.appendChild(fieldGroup);

                // Add event listener to remove button
                fieldGroup.querySelector('.remove-field').addEventListener('click', function() {
                    certificationFields.removeChild(fieldGroup);
                });
            });

            // Theme selection
            const colorOptions = document.querySelectorAll('.color-option');
            let primaryColor = '#3f51b5'; // Default color
            let lightTextColor = '#777'; // Default light text color

            colorOptions.forEach(option => {
                option.addEventListener('click', function() {
                    colorOptions.forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                    primaryColor = this.getAttribute('data-color');
                    document.documentElement.style.setProperty('--primary-color', primaryColor);

                    // Define light text color based on primary
                    lightTextColor = (primaryColor === '#3f51b5' || primaryColor === '#2196F3' || primaryColor === '#9C27B0') ? '#777' : '#777';
                    document.documentElement.style.setProperty('--light-text', lightTextColor);
                    
                    // If we're on preview tab, regenerate preview with new colors
                    if (tabs[currentTab].getAttribute('data-tab') === 'preview') {
                        generatePreview();
                    }
                });
            });

            // Generate CV preview
            function generatePreview() {
                const cvPreview = document.getElementById('cv-preview');

                // Get personal information
                const name = document.getElementById('name').value || 'Your Name';
                const title = document.getElementById('title').value || 'Professional Title';
                const email = document.getElementById('email').value || 'email@example.com';
                const phone = document.getElementById('phone').value || '+1 (123) 456-7890';
                const address = document.getElementById('address').value || '';
                const linkedin = document.getElementById('linkedin').value || '';
                const website = document.getElementById('website').value || '';
                const summary = document.getElementById('summary').value || 'Professional summary goes here...';
                const photoSrc = document.getElementById('photo-preview-img').src;

                // Get skills
                const skillsInput = document.getElementById('skills-input').value;
                const skills = skillsInput ? skillsInput.split(',').map(skill => skill.trim()).filter(skill => skill) : [];

                // Start building the CV HTML
                let cvHTML = `
                    <div class="cv-header">
                        <div class="profile-img-container">
                            <img class="profile-img" src="${photoSrc}" alt="Profile Photo">
                        </div>
                        <div>
                            <h1 class="cv-name">${name}</h1>
                            <h2 class="cv-title">${title}</h2>
                            <div class="contact-info">
                `;

                // Add contact information
                if (email) cvHTML += `<div class="contact-item"><span class="contact-icon">✉</span> ${email}</div>`;
                if (phone) cvHTML += `<div class="contact-item"><span class="contact-icon">📞</span> ${phone}</div>`;
                if (address) cvHTML += `<div class="contact-item"><span class="contact-icon">📍</span> ${address}</div>`;
                if (linkedin) cvHTML += `<div class="contact-item"><span class="contact-icon">🔗</span> ${linkedin}</div>`;
                if (website) cvHTML += `<div class="contact-item"><span class="contact-icon">🌐</span> ${website}</div>`;

                cvHTML += `
                            </div>
                        </div>
                    </div>
                `;

                // Add summary section
                if (summary) {
                    cvHTML += `
                        <div class="cv-section">
                            <h3 class="cv-section-title">Professional Summary</h3>
                            <div class="cv-section-content">
                                <p>${summary}</p>
                            </div>
                        </div>
                    `;
                }

                // Add experience section
                const experienceItems = document.querySelectorAll('.field-group:has(.experience-title)');
                
                // Fallback for browsers that don't support :has selector
                let expElements = [];
                document.querySelectorAll('.field-group').forEach(group => {
                    if (group.querySelector('.experience-title')) {
                        expElements.push(group);
                    }
                });

                if (expElements.length > 0) {
                    cvHTML += `
                        <div class="cv-section">
                            <h3 class="cv-section-title">Work Experience</h3>
                            <div class="cv-section-content">
                    `;

                    expElements.forEach(item => {
                        const title = item.querySelector('.experience-title').value || 'Job Title';
                        const company = item.querySelector('.experience-company').value || 'Company';
                        const location = item.querySelector('.experience-location').value || '';
                        const period = item.querySelector('.experience-period').value || 'Date Period';
                        const description = item.querySelector('.experience-description').value || '';
                        
                        let companyLocation = company;
                        if (location) {
                            companyLocation += `, ${location}`;
                        }

                        cvHTML += `
                            <div class="experience-item">
                                <div class="item-header">
                                    <div class="item-title">${title}</div>
                                    <div class="item-date">${period}</div>
                                </div>
                                <div class="item-subtitle">${companyLocation}</div>
                                <p>${description}</p>
                            </div>
                        `;
                    });

                    cvHTML += `
                            </div>
                        </div>
                    `;
                }

                // Add education section
                const eduElements = [];
                document.querySelectorAll('.field-group').forEach(group => {
                    if (group.querySelector('.education-degree')) {
                        eduElements.push(group);
                    }
                });

                if (eduElements.length > 0) {
                    cvHTML += `
                        <div class="cv-section">
                            <h3 class="cv-section-title">Education</h3>
                            <div class="cv-section-content">
                    `;

                    eduElements.forEach(item => {
                        const degree = item.querySelector('.education-degree').value || 'Degree';
                        const institution = item.querySelector('.education-institution').value || 'Institution';
                        const location = item.querySelector('.education-location').value || '';
                        const period = item.querySelector('.education-period').value || 'Date Period';
                        const description = item.querySelector('.education-description').value || '';
                        
                        let schoolLocation = institution;
                        if (location) {
                            schoolLocation += `, ${location}`;
                        }

                        cvHTML += `
                            <div class="education-item">
                                <div class="item-header">
                                    <div class="item-title">${degree}</div>
                                    <div class="item-date">${period}</div>
                                </div>
                                <div class="item-subtitle">${schoolLocation}</div>
                                ${description ? `<p>${description}</p>` : ''}
                            </div>
                        `;
                    });

                    cvHTML += `
                            </div>
                        </div>
                    `;
                }

                // Add skills section
                if (skills.length > 0) {
                    cvHTML += `
                        <div class="cv-section">
                            <h3 class="cv-section-title">Skills</h3>
                            <div class="cv-section-content">
                                <div class="skills-container">
                    `;

                    skills.forEach(skill => {
                        cvHTML += `<div class="skill-tag">${skill}</div>`;
                    });

                    cvHTML += `
                                </div>
                            </div>
                        </div>
                    `;
                }

                // Add certifications section
                const certElements = [];
                document.querySelectorAll('.field-group').forEach(group => {
                    if (group.querySelector('.certification-name')) {
                        certElements.push(group);
                    }
                });

                if (certElements.length > 0) {
                    cvHTML += `
                        <div class="cv-section">
                            <h3 class="cv-section-title">Certifications</h3>
                            <div class="cv-section-content">
                    `;

                    certElements.forEach(item => {
                        const name = item.querySelector('.certification-name').value || 'Certification';
                        const org = item.querySelector('.certification-org').value || 'Organization';
                        const date = item.querySelector('.certification-date').value || '';
                        const description = item.querySelector('.certification-description').value || '';

                        cvHTML += `
                            <div class="certification-item">
                                <div class="item-header">
                                    <div class="item-title">${name}</div>
                                    ${date ? `<div class="item-date">${date}</div>` : ''}
                                </div>
                                <div class="item-subtitle">${org}</div>
                                ${description ? `<p>${description}</p>` : ''}
                            </div>
                        `;
                    });

                    cvHTML += `
                            </div>
                        </div>
                    `;
                }

                // Set the generated HTML to the preview
                cvPreview.innerHTML = cvHTML;

                // Apply the selected color theme to the preview
                cvPreview.style.setProperty('--primary-color', primaryColor);
                cvPreview.style.setProperty('--light-text', lightTextColor);
            }

            // Initial dynamic field
            if (document.getElementById('education-fields').children.length === 0) {
                addEducationBtn.click();
            }
            if (document.getElementById('experience-fields').children.length === 0) {
                addExperienceBtn.click();
            }
            if (document.getElementById('certification-fields').children.length === 0) {
                addCertificationBtn.click();
            }

            // PDF download functionality
            document.getElementById('download-pdf').addEventListener('click', function() {
                const previewElement = document.getElementById('cv-preview');
                
                // Create a PDF with jsPDF and html2canvas
                html2canvas(previewElement).then(canvas => {
                    const imgData = canvas.toDataURL('image/png');
                    const pdf = new jsPDF('p', 'mm', 'a4');
                    const imgProps = pdf.getImageProperties(imgData);
                    
                    // Calculate dimensions to fit A4
                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
                    
                    pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
                    
                    // Get file name from user's name or use default
                    const userName = document.getElementById('name').value || 'Your';
                    pdf.save(`${userName.split(' ')[0]}_CV.pdf`);
                });
            });
        });
    </script>
</body>
</html>